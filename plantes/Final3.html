<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Camille vs. La Jungle ‚Äì Le Quiz qui fait pousser le cerveau üåøüß†</title>
  <style>
    :root { --bg:#0f172a; --card:#111827cc; --text:#e5e7eb; --muted:#9ca3af; --ok:#22c55e; --no:#ef4444; --info:#3b82f6; }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 10% -20%,#1f2937,#0f172a);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    .container{max-width:1000px;margin:24px auto;padding:16px}
    .card{background:var(--card);backdrop-filter:blur(6px);border:1px solid #1f2937;border-radius:20px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    h1{font-size:20px;margin:0;color:#f3f4f6}
    .pill{font-size:12px;color:var(--muted);background:#0b1220;border:1px solid #1f2937;padding:6px 10px;border-radius:999px}
    .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:780px){.grid{grid-template-columns:1.2fr 1fr}}
    .image-wrap{position:relative;border-radius:16px;overflow:hidden;background:#0b1220;border:1px solid #1f2937;min-height:320px;display:flex;align-items:center;justify-content:center}
    .image-wrap img{width:100%;height:100%;object-fit:cover;display:block}
    .image-caption{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.7));padding:12px 14px;font-size:13px;color:#d1d5db}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:#cbd5e1}
    input{padding:12px 14px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--text)}
    input:focus{outline:none;border-color:#64748b}
    .row{display:grid;gap:10px}
    @media(min-width:560px){.row{grid-template-columns:1fr 1fr}}
    button{cursor:pointer;border:1px solid #334155;background:#0b1220;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600}
    button:hover{border-color:#475569}
    .btn-primary{background:linear-gradient(135deg,#0b1220,#12233f);border-color:#3b82f633}
    .btn-accent{background:linear-gradient(135deg,#0b1220,#0f2a1a);border-color:#22c55e55}
    .btn-danger{background:linear-gradient(135deg,#0b1220,#340e11);border-color:#ef444455}
    .status{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px;margin-bottom:8px;flex-wrap:wrap}
    .toast{margin-top:10px;font-weight:700}
    .toast.ok{color:var(--ok)}
    .toast.mid{color:var(--info)}
    .toast.no{color:var(--no)}
    footer{margin-top:12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .muted{color:var(--muted);font-size:12px}
    pre{white-space:pre-wrap;background:#0b1220;border:1px solid #1f2937;padding:10px;border-radius:12px;overflow:auto;max-height:260px}
    .anecdote{font-size:13px;color:#c7d2fe;margin-top:6px}
    .hidden{display:none}
    /* Results page */
    .results{display:none}
    .results h2{margin-top:0}
    .media{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
    .media img{max-width:240px;border-radius:12px;border:1px solid #1f2937}
    .list{margin-top:8px}
    .list li{margin:4px 0}
  </style>
</head>
<body>
  <div class="container">
    <!-- QUIZ VIEW -->
    <div id="view-quiz" class="card">
      <header>
        <h1>Camille vs. La Jungle ‚Äì Le Quiz qui fait pousser le cerveau üåøüß†</h1>
        <div class="controls">
          <span class="pill" id="phase">Manche 1 / 2</span>
          <span class="pill" id="progress">Question 1 / 12</span>
          <span class="pill" id="score">Score : 0</span>
          <span class="pill" id="bonus">Bonus temps : 0 s</span>
          <span class="pill" id="streak">S√©rie: 0 ‚úÖ</span>
          <button id="btn-skip" class="btn-primary" title="Passer la question">Passer ‚Ü∑</button>
        </div>
      </header>

      <div class="grid">
        <div class="image-wrap">
          <img id="photo" alt="Photo de la plante" />
          <div class="image-caption" id="caption">Astuce : observe feuilles, √©corce, floraison‚Ä¶ (saisie exacte demand√©e, Camille)</div>
        </div>
        <div>
          <div class="status">
            <span id="famille" class="pill">Famille : ‚Äî</span>
            <span class="pill">Camille, tape exactement majuscules, accents et apostrophes.</span>
          </div>
          <div class="row">
            <div class="field">
              <label for="latin">Nom latin (exact)</label>
              <input id="latin" placeholder="ex : Quercus robur" autocomplete="off" />
            </div>
            <div class="field">
              <label for="commun">Nom commun (exact)</label>
              <input id="commun" placeholder="ex : Ch√™ne p√©doncul√©" autocomplete="off" />
            </div>
          </div>
          <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
            <button id="btn-validate" class="btn-accent">Valider</button>
            <button id="btn-reveal" class="btn-primary">Afficher la r√©ponse</button>
            <button id="btn-reset" class="btn-danger">R√©initialiser</button>
            <button id="btn-next" class="btn-primary hidden">Question suivante ‚Üí</button>
          </div>
          <div class="toast" id="toast"></div>
          <div class="anecdote" id="anec"></div>
          <!-- Mini c√©l√©bration pour 3 bonnes r√©ponses d'affil√©e -->
          <div id="celebration" class="card hidden" style="margin-top:10px;padding:14px;background:#0b1220;border:1px solid #1f2937;">
            <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
              <img id="celebration-gif" src="" alt="Bravo Camille !" style="max-width:180px;border-radius:12px;border:1px solid #1f2937"/>
              <div>
                <div style="font-weight:800;margin-bottom:6px">üéâ Hat-trick botanique, Camille ! 3 bonnes r√©ponses d‚Äôaffil√©e !</div>
                <div style="opacity:.9">Continue comme √ßa, la jungle est √† toi. (+10 s d√©j√† ajout√©es sur cette question)</div>
                <div style="margin-top:10px"><button id="celebration-next" class="btn-primary">Question suivante ‚Üí</button></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <details class="card" style="margin-top:12px;">
        <summary><b>‚öôÔ∏è Param√®tres & donn√©es</b> ‚Äî clique pour voir / modifier</summary>
        <p class="muted">√âdite la liste des plantes. <b>latin</b> et <b>commun</b> peuvent avoir des alias (s√©par√©s par <code>|</code>). <b>image</b> = chemin vers l'image. <b>famille</b> reste affich√©e pendant la question.</p>
        <pre id="data-preview"></pre>
      </details>
    </div>

    <!-- RESULTS VIEW -->
    <div id="view-results" class="card results">
      <h2>Bravo Camille ! R√©sultats de la session üåü</h2>
      <p id="summary"></p>
      <div class="media">
        <audio id="applause" controls src="audio/victory.mp3">Votre navigateur ne supporte pas l'audio.</audio>
        <img id="gif" src="images/victory1.gif" alt="Victoire !" />
      </div>
      <div class="list-wrap">
        <h3>√Ä revoir (erreurs au premier essai)</h3>
        <ul id="wrong-list" class="list"></ul>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="btn-replay" class="btn-accent">Rejouer une nouvelle session</button>
        <button id="btn-back" class="btn-primary">Retour au quiz</button>
      </div>
      <p class="muted" style="margin-top:8px">Astuce : place un fichier audio √† <code>audio/victory.mp3</code> et des gifs nomm√©s <code>images/victory1.gif</code> ‚Ä¶ <code>images/victory12.gif</code>.</p>
    </div>
  </div>

  <script>
    // === Donn√©es (mets tes images dans /images) ===
    const PLANTES_MASTER = [
      { latin: "Carpinus betulus", commun: "Charme commun|Charme", famille: "Betulaceae", image: "images/carpinus_betulus.jpg" },
      { latin: "Acer palmatum", commun: "√ârable du Japon|Erable du Japon", famille: "Aceraceae", image: "images/acer_palmatum.jpg" },
      { latin: "Acer platanoides", commun: "√ârable plane|Erable plane", famille: "Aceraceae", image: "images/acer_platanoides.jpg" },
      { latin: "Quercus robur", commun: "Ch√™ne p√©doncul√©", famille: "Fagaceae", image: "images/quercus_robur.jpg" },
      { latin: "Quercus rubra", commun: "Ch√™ne rouge d‚ÄôAm√©rique", famille: "Fagaceae", image: "images/quercus_rubra.jpg" },
      { latin: "Liquidambar styraciflua", commun: "Copalme d‚ÄôAm√©rique", famille: "Altingiaceae", image: "images/liquidambar_styraciflua.jpg" },
      { latin: "Ginkgo biloba", commun: "Ginkgo", famille: "Ginkgoaceae", image: "images/ginkgo_biloba.jpg" },
      { latin: "Cornus sanguinea", commun: "Cornouiller sanguin", famille: "Cornaceae", image: "images/cornus_sanguinea.jpg" },
      { latin: "Hamamelis mollis", commun: "Hamam√©lis de Chine", famille: "Hamamelidaceae", image: "images/hamamelis_mollis.jpg" },
      { latin: "Magnolia √ó soulangeana", commun: "Magnolia de Soulange", famille: "Magnoliaceae", image: "images/magnolia_soulangeana.jpg" },
      { latin: "Acer griseum", commun: "√ârable √† √©corce de papier", famille: "Aceraceae", image: "images/acer_griseum.jpg" },
      { latin: "Koelreuteria paniculata", commun: "Savonnier", famille: "Sapindaceae", image: "images/koelreuteria_paniculata.jpg" }
    ];

    // === Anecdotes √©tendues ===
    const ANECDOTES = {
      "Carpinus betulus": "Son bois tr√®s dur servait aux engrenages de moulins ‚Äî comme Camille, il ne casse pas sous la pression !",
      "Acer palmatum": "Au Japon, on c√©l√®bre sa beaut√© en automne durant le momijigari, un festival de feuilles flamboyantes.",
      "Acer platanoides": "On le reconna√Æt √† son latex collant‚Ä¶ un peu comme Camille accroch√©e √† ses r√©visions !",
      "Quercus robur": "Symbole de force, ce ch√™ne vit plus de 500 ans. Patience et robustesse : deux qualit√©s que Camille partage !",
      "Quercus rubra": "Son feuillage rouge vif illumine les for√™ts en automne ‚Äî comme le sourire de Camille dans une serre.",
      "Liquidambar styraciflua": "Sa r√©sine parfum√©e, l‚Äôambre liquide, √©tait jadis utilis√©e en parfumerie.",
      "Ginkgo biloba": "Apparu il y a plus de 200 millions d‚Äôann√©es, c‚Äôest un survivant de la pr√©histoire ‚Äî et une star des jardins asiatiques.",
      "Cornus sanguinea": "Ses rameaux rouges en hiver rappellent que m√™me sans feuilles, la nature reste color√©e.",
      "Hamamelis mollis": "Fleurit au c≈ìur de l‚Äôhiver ! Ses fleurs jaunes s‚Äôouvrent dans le froid ‚Äî comme Camille devant un d√©fi.",
      "Magnolia √ó soulangeana": "Hybride horticole cr√©√© en France, c√©l√®bre pour ses grandes fleurs printani√®res.",
      "Acer griseum": "L‚Äô√©corce s‚Äôexfolie en lamelles cannelle : d√©coratif toute l‚Äôann√©e !",
      "Koelreuteria paniculata": "Surnomm√© l‚Äôarbre aux lanternes chinoises √† cause de ses fruits gonfl√©s.",
      "Fagus sylvatica": "Le h√™tre commun peut atteindre 40 m et former des for√™ts f√©√©riques.",
      "Prunus avium": "Cerisier des oiseaux : ses fruits rouges attirent la faune.",
      "Tilia platyphyllos": "Floraison embaumante en juin ‚Äî un parfum apaisant comme une balade avec Camille.",
      "Gleditsia triacanthos": "De longues √©pines prot√®gent un arbre tr√®s √©l√©gant.",
      "Cercis siliquastrum": "Appel√© arbre de Jud√©e : ses fleurs roses apparaissent avant les feuilles !",
      "Melia azedarach": "Ses fruits persistent tout l‚Äôhiver : les oiseaux en raffolent.",
      "Sophora japonica": "Symbole de sagesse en Asie, souvent plant√© pr√®s des temples.",
      "Cotinus coggygria": "Feuillage pourpre et inflorescences vaporeuses : l‚Äô¬´ arbre √† perruques ¬ª.",
      "Betula pendula": "Tronc blanc et feuillage l√©ger : la lumi√®re danse au vent."
    };

    // === Phrases de fin rigolotes ===
    const FUNNY = [
      "Camille, tu es la reine de la chlorophylle ! üåøüëë",
      "Camille, les plantes t‚Äôapplaudissent avec leurs feuilles ! üëèüçÉ",
      "Camille, tu pousses plus vite qu‚Äôun bambou bien arros√© ! üéã",
      "Camille, photosynth√®se 100 % r√©ussie, bravo ! ‚òÄÔ∏è",
      "Camille, tu viens d‚Äôobtenir ton bac... botanique ! üéìüå±",
      "Camille, tu m√©rites une m√©daille en compost recyclable ! ü•á‚ôªÔ∏è",
      "Camille, m√™me Darwin aurait √©t√© impressionn√© ! üß¨üå∫",
      "Camille, tu es l‚Äô√©l√®ve la plus chlorophyllienne de la saison ! üçÄ",
      "Camille, ton cerveau fleurit plus vite qu‚Äôun magnolia au printemps ! üå∏",
      "Camille, les racines du savoir sont profondes‚Ä¶ et tu les ma√Ætrises √† merveille ! üå≥"
    ];

    // === Messages d'encouragement variables ===
    const MSG_LATIN_ONLY = [
      "Bien jou√© Camille pour le latin ! Le nom commun reste √† caler, tu y es presque.",
      "Latin parfait, Camille ! Trouve le nom commun exact et c‚Äôest gagn√©.",
      "Le latin, c‚Äôest valid√©, Camille. Le nom commun va suivre !"
    ];
    const MSG_COMMUN_ONLY = [
      "Top pour le nom commun, Camille ! Maintenant, vise juste pour le latin.",
      "Nom commun impeccable ! Le latin doit √™tre exactement identique.",
      "Encore un effort pour le latin, Camille, tu es √† une feuille de la victoire."
    ];
    const MSG_BOTH_WRONG = [
      "Courage Camille ! Respire, observe, et retente en respectant bien chaque caract√®re.",
      "On arrose et on recommence, Camille ! Tu vas y arriver.",
      "Pas grave, Camille : chaque erreur est du compost pour la prochaine r√©ussite !"
    ];

    // === Utilitaires ===
    const $ = s => document.querySelector(s);
    const shuffle = a => a.map(v=>({v,r:Math.random()})).sort((x,y)=>x.r-y.r).map(o=>o.v);
    const trim = s => (s||"").toString().trim();
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    const randomVictoryGif = () => `images/victory${1 + Math.floor(Math.random()*12)}.gif`;

    function matchesExact(input, canonical){
      const val = trim(input);
      return canonical.split('|').some(opt => trim(opt) === val);
    }

    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }
    function showQuiz(){ $('#view-results').style.display='none'; $('#view-quiz').style.display='block'; }
    function showResults(){ $('#view-quiz').style.display='none'; $('#view-results').style.display='block'; }

    // === √âtat ===
    let score = 0, question = 0, bonusSeconds = 0;
    let phase = 'round1'; // 'round1' -> 'review' -> 'done'
    let deck = [];          // 12 plantes pour la session
    let reviewDeck = [];    // celles rat√©es au premier essai
    let current = null;
    let firstAttemptPending = true; // pour savoir si on en est au 1er essai de la question
    let streak = 0; // s√©rie de bonnes r√©ponses cons√©cutives

    function startNewSession(){
      score = 0; question = 0; bonusSeconds = 0; phase = 'round1'; streak = 0;
      const shuffled = shuffle([...PLANTES_MASTER]);
      deck = shuffled.slice(0, 12); // 12 questions
      reviewDeck = [];
      $('#score').textContent = 'Score : 0';
      $('#bonus').textContent = 'Bonus temps : 0 s';
      $('#streak').textContent = 'S√©rie: 0 ‚úÖ';
      $('#phase').textContent = 'Manche 1 / 2';
      $('#progress').textContent = 'Question 1 / 12';
      showQuiz();
      loadNext();
    }

    function startReview(){
      phase = 'review';
      deck = shuffle([...reviewDeck]);
      question = 0;
      $('#phase').textContent = 'Manche 2 / 2 ‚Äì R√©visions des erreurs du 1er essai';
      $('#progress').textContent = deck.length ? `Question 1 / ${deck.length}` : 'Aucune erreur √† revoir üéâ';
      loadNext();
    }

    function finish(){
      phase = 'done';
      const totalQ = 12 + reviewDeck.length;
      const summary = `Score : ${score} / ${totalQ} ‚Äî Temps bonus total : ${bonusSeconds} s.`;
      $('#summary').textContent = pick(FUNNY) + " " + summary;
      const list = $('#wrong-list');
      list.innerHTML = '';
      reviewDeck.forEach(p=>{
        const li = document.createElement('li');
        li.textContent = `${p.latin} ‚Äî ${p.commun.split('|')[0]} (Famille : ${p.famille})`;
        list.appendChild(li);
      });
      // Choisir un GIF de victoire al√©atoire parmi 12
      const gif = $('#gif');
      if (gif) gif.src = randomVictoryGif();
      // Affiche la page de r√©sultats avec audio + gif
      showResults();
      const audio = $('#applause');
      if (audio) { try { audio.currentTime = 0; audio.play().catch(()=>{}); } catch(e){} }
    }

    function loadNext(){
      hide($('#btn-next'));
      hide($('#celebration'));
      $('#toast').textContent = '';
      $('#anec').textContent = '';
      $('#latin').value = '';
      $('#commun').value = '';

      if(deck.length === 0){
        if(phase === 'round1'){
          startReview();
          return;
        } else if(phase === 'review'){
          finish();
          return;
        }
      }

      current = deck.pop();
      firstAttemptPending = true;
      question++;
      $('#progress').textContent = `Question ${question} / ${phase==='round1'?12:(reviewDeck.length||1)}`;
      $('#score').textContent = `Score : ${score}`;
      $('#bonus').textContent = `Bonus temps : ${bonusSeconds} s`;
      $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
      $('#photo').src = current.image || '';
      $('#photo').alt = `Photo: ${current.latin}`;
      $('#famille').textContent = `Famille : ${current.famille || '‚Äî'}`;
      $('#caption').textContent = current.image ? `Observe : feuilles, √©corce, floraison‚Ä¶` : `‚ö†Ô∏è Pas d'image d√©finie pour ${current.latin}`;
    }

    function validate(){
      const latinOk = matchesExact($('#latin').value, current.latin);
      const communOk = matchesExact($('#commun').value, current.commun || '');

      if(latinOk && communOk){
        score++;
        bonusSeconds += 10;
        streak++;
        $('#score').textContent = `Score : ${score}`;
        $('#bonus').textContent = `Bonus temps : ${bonusSeconds} s`;
        $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
        const an = ANECDOTES[current.latin] || "Fun fact : cette esp√®ce a bien plus d'histoires que de feuilles !";
        $('#toast').textContent = `‚úî Bravo Camille ! R√©ponse parfaite. (+10 s)`;
        $('#toast').className = 'toast ok';
        $('#anec').textContent = an;
        show($('#btn-next'));
        // C√©l√©bration si 3 d'affil√©e
        if (streak === 3) {
          const cg = $('#celebration-gif');
          if (cg) cg.src = randomVictoryGif();
          show($('#celebration'));
          // reset la s√©rie pour viser un nouveau tripl√©
          streak = 0; $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
        }
      } else if(latinOk && !communOk){
        $('#toast').textContent = pick(MSG_LATIN_ONLY);
        $('#toast').className = 'toast mid';
        if(firstAttemptPending){ reviewDeck.push(current); firstAttemptPending = false; }
        streak = 0; $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
      } else if(!latinOk && communOk){
        $('#toast').textContent = pick(MSG_COMMUN_ONLY);
        $('#toast').className = 'toast mid';
        if(firstAttemptPending){ reviewDeck.push(current); firstAttemptPending = false; }
        streak = 0; $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
      } else {
        $('#toast').textContent = pick(MSG_BOTH_WRONG);
        $('#toast').className = 'toast no';
        if(firstAttemptPending){ reviewDeck.push(current); firstAttemptPending = false; }
        streak = 0; $('#streak').textContent = `S√©rie: ${streak} ‚úÖ`;
      }
    }

    function reveal(){
      $('#latin').value = current.latin;
      const firstAlias = (current.commun||'').split('|')[0] || '';
      $('#commun').value = firstAlias;
      $('#toast').textContent = 'R√©ponse affich√©e. Recopie-la √† l‚Äôidentique, Camille (majuscules, accents et apostrophes compris).';
      $('#toast').className = 'toast mid';
      const an = ANECDOTES[current.latin];
      if(an){ $('#anec').textContent = an; }
      show($('#btn-next'));
      if(firstAttemptPending){ reviewDeck.push(current); firstAttemptPending = false; }
      // petite c√©l√©bration visuelle pour ancrer la r√©ponse
      const cg = $('#celebration-gif');
      if (cg) cg.src = randomVictoryGif();
      show($('#celebration'));
    }

    function reset(){ startNewSession(); }

    function refreshPreview(){
      const sample = PLANTES_MASTER.map(p=>`‚Ä¢ ${p.latin}  ‚Äî  ${p.commun||'‚Äî'}  ‚Äî  ${p.famille||'‚Äî'}  ‚Äî  ${p.image||'images/...'}`).join('\n');
      $('#data-preview').textContent = sample;
    }

    // === Listeners ===
    $('#btn-validate').addEventListener('click', validate);
    $('#btn-reveal').addEventListener('click', reveal);
    $('#btn-reset').addEventListener('click', reset);
    $('#btn-skip').addEventListener('click', loadNext);
    $('#btn-next').addEventListener('click', loadNext);
    $('#celebration-next').addEventListener('click', loadNext);
    $('#latin').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); $('#commun').focus(); }});
    $('#commun').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); validate(); }});
    $('#btn-replay').addEventListener('click', startNewSession);
    $('#btn-back').addEventListener('click', ()=>{ showQuiz(); });

    // === Init ===
    refreshPreview();
    startNewSession();
  </script>
</body>
</html>
